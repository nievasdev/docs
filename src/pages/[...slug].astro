---
import Layout from '../layouts/Layout.astro';
import Sidebar from '../components/Sidebar.astro';
import ContentRenderer from '../components/ContentRenderer.astro';
import { readMenusRecursively, extractAllPaths } from '../utils/menuLoader';

export async function getStaticPaths() {
  const menuStructures = await readMenusRecursively();
  const allPaths = extractAllPaths(menuStructures);

  return allPaths.map(path => ({
    params: { slug: path.slug },
    props: {
      title: path.title,
      content: path.content
    }
  }));
}

const { title, content } = Astro.props;
const { breadcrumb, sections } = content;
---

<Layout title={`${title} - Docs`}>
  <div class="sidebar-overlay" id="sidebar-overlay"></div>

  <main class="docs-layout">
    <Sidebar />

    <div class="content">
      <button class="menu-toggle" aria-label="Toggle menu" id="menu-toggle" onclick="playTerminalSound()">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <div class="breadcrumb">
        {breadcrumb.map((crumb, index) => (
          <>
            {index === 0 ? (
              <a href="/" onclick="playTerminalSound()">{crumb}</a>
            ) : index === breadcrumb.length - 1 ? (
              <span>{crumb}</span>
            ) : (
              <a href="#" onclick="playTerminalSound()">{crumb}</a>
            )}
            {index < breadcrumb.length - 1 && <span>â€º</span>}
          </>
        ))}
      </div>

      <div class="content-header">
        <h1>{title}</h1>
      </div>

      <section>
        <ContentRenderer sections={sections} />
      </section>
    </div>
  </main>

  <script>
const m=document.getElementById('menu-toggle'),s=document.querySelector('.sidebar'),o=document.getElementById('sidebar-overlay');function p(){s?.classList.add('mobile-open');o?.classList.add('active');document.body.style.overflow='hidden'}function c(){s?.classList.remove('mobile-open');o?.classList.remove('active');document.body.style.overflow=''}m?.addEventListener('click',()=>{s?.classList.contains('mobile-open')?c():p()});o?.addEventListener('click',()=>{typeof playTerminalSound==='function'&&playTerminalSound();c()});s?.querySelectorAll('a').forEach(l=>l.addEventListener('click',c));
  </script>
</Layout>
